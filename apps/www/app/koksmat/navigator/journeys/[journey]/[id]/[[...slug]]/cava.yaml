journey: v1
metadata:
  app: cava
  name: Meeting
  description: |
    This is the recipie for running a meeting. Each "instance"
    of this recipie is called a ship, and what is keeping everybody
    onboard are the Koksmat's which do all of the trivial work of
    making nice food and drinks for the crew and the passengers.

waypoints:
  - port: Planning
    loads:
      containers:
        - container:
          name: Prepare Meeting
          key: meeting:10.10
          who:
            - organizer
              email
              title
              name
            - chair    
              email
              title
              name                 
          needs: 
            - meetingPurpose

          produces: 
            - agenda-suggestion
            - time-suggestion
            - place-suggestion
          script: |
            write-host "Prepared agenda"

        - container:
          name: Pre Settlement
          key: meeting:10.20          
          who:
            - organizer   
          needs: 
            - attendees-proposed 
              email
              role       
            - time-suggestion
              day:number
              hour:number
              lengthInMinutes:number
            - place-suggestion
              site
              building
            - meetingPurpose      
            - agenda-suggestion
              title
              description
              durationInMinutes
              presenter
              attendees
          produces: 
            - time-agreed
            - place-agreed
            - agenda-agreed
            - attendees
          script: |
            write-host "Aggreed on time,place and agenda"    
  
        - container:
          name: Settle Meeting
          key: meeting:10.30          
          who:
            - organizer
            - chair            
          needs: 
            - attendee-list
            - time-agreed
            - place-agreed
            - agenda-agreed
          produces: 
            - agenda
            - time
            - place
          script: |
            write-host "Agenda approved"                     
      
        - container:
          name: Prepare Invitation
          key: meeting:10.40          
          who:
            - organizer
            - chair            
          needs: 
            - attendees
            - agenda
            - time
            - place
          produces: 
            - resources-requirements
          script: |
            write-host "Resources being booked" 
      
        - container:
          name: Resource Booking
          key: meeting:10.50          
          who:
            - organizer
            - resourceowner            
          needs: 
            - resources-suggestion
            - time
            - place
          produces: 
            - resources-booking
          script: |
            write-host "Resources being booked"                                   
        
        - container:
          name: Invite
          key: meeting:10.60          
          who:
            - organizer        
          needs: 
            - resource-requirements            
            - resource-booking            
            - organizer
            - attendees
            - agenda
            - time
            - place
          produces: 
            - invitation
          script: |
            write-host "Invitation send"     
  - port: Acceptance
    loads:
      containers:
        - container:
          name: RSVP
          key: meeting:20.10          
          who: 
            - attendees
          needs:   
            - invitation   
          produces: 
            - rsvp            
          script: |
            write-host "Invitation Received"                           
        - container:
          name: Process RSVP
          key: meeting:20.20          
          who: 
            - organizer  
          needs:   
            - rsvps
          produces: 
            - attendeestatues        
          script: |
            write-host "RSVP Received"   
  - port: Service Ordering
    loads:
      containers:    
        - container:
          name: Service Ordering
          key: meeting:30.10          

          who: 
            - organizer
          needs:   
            - rsvps   
          produces: 
            - serviceorder-request            
          script: |
            write-host "Service Order Requested"                
  - port: Arrival
    loads:
      containers:  
        - container:
          name: Arrival
          key: meeting:30.10          

          who: 
            - attendees
          needs:   
            - invitation   
          produces: 
            - rsvp            
          script: |
            write-host "Arrival Received"               
  - port: Meet
    loads:
      containers:    
        - container:
          name: Meet
          key: meeting:40.10          

          who: 
            - attendees
          needs:   
            - invitation   
          produces: 
            - rsvp            
          script: |
            write-host "Meet Received"             
  - port: Departure
    loads:
      containers:    
        - container:
          name: Departure
          key: meeting:50.10          

          who: 
            - attendees
          needs:   
            - invitation   
          produces: 
            - rsvp            
          script: |
            write-host "Departure Received"             

  - port: Resource services
    loads:
      containers: 
        - container:
          name: Resource Booking
          key: meeting:60.10          

          who:
            - organizer
            - resourceowner            
          needs: 
            - resources-suggestion
            - time
            - place
          produces: 
            - resources-booking
          script: |
            write-host "Resources being booked"
  - port: Catering Services
    services:
      - tugs:
        - tug:
          name: Change to meeting

          who: 
            - attendees
          needs:   
            - invitation 
            - time  
          produces: 
            - serviceorder-change
            - resources-suggestion          
          script: |
            write-host "Change monitoring"
    loads:
      containers:    
        - container:
          name: Approval
          key: meeting:70.10          
          who: 
            - dispatcher
          needs:   
            - serviceorder-request   
          produces: 
            - serviceorder-approved
                      
          script: |
            write-host "Back Office Received"                
        - container:
          name: Production
          key: meeting:70.20          
          who: 
            - serviceprovider
          needs:   
            - serviceorder-approved  
          produces: 
            - serviceorder             
          script: |
            write-host "Service produced"                
        - container:
          name: Delivery
          key: meeting:70.30          

          who: 
            - serviceprovider
          needs:   
            - serviceorder
          produces: 
            - invoice-suggestion            
          script: |
            write-host "Service delivered"                
        - container:
          name: Invoicing
          key: meeting:70.40          

          who: 
            - finance
          needs:   
            - invoice-suggestion 
          produces: 
            - invoice           
          script: |
            write-host "Invoice produced"         
        - container:
          name: Service Order Payment
          key: meeting:70.50          

          who: 
            - organizer
          needs:   
            - invoice 
          produces: 
            - payment            
          script: |
            write-host "Payment send"       
